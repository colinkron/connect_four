<!-- Contains HTML and the Javascript for the form data

1:12pm:https://stackoverflow.com/questions/17863986/is-there-a-way-to-pass-javascript-variables-in-url
for coding the url....


 -->
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="apistyle.css">
    <title>Sign in Page</title>
    <!-- <script src="script.js"></script> -->
</head>

<body onload="getImage(true, false)">

  <div class="main">
    <p class="sign" align="center">Sign in </p>
    <form method="POST" name="form" action="/game">
      <input class="field" type="text" name="username" placeholder="Username" required>
      <!-- <input class="field" type="text" name="password" placeholder="Password" required> -->
      <input class="field" type="text" name="image" placeholder="Your Image" onchange="return getImage(false, false)" required>
      <input type="submit" class="submit" set="Sign In" action ></input>
      <p class="linker" align="center"><a href="https://spencergallant.github.io/comp20_api/">Reference for the Image API</a></p>
    </form>



  </div>
    <p class = "text" id = "note">Your game background based on your image keyword </p> <br/>
    <div class="picture" id = "picture"></div> <br/>
    <p class = "image" id = "image"> </p> <br/>

  <script>
      //----------------------IMAGE CODE--------------------//
      numImage = 0;
      previousWord = "image";
      function getImage(default_image, retry) {
        if(default_image) word = "image";
        else if(retry) word = "retry";
        else word = document.form.image.value;

        if(previousWord == word) numImage = numImage + 1;
        else numImage = 0;

        previousWord = word;

        request = new XMLHttpRequest();
        request.open("GET", "https://pixabay.com/api/?key=15909759-b4111d3c13a2b72bb3717136f&q=" + word, true);

        request.onreadystatechange = function() {
          if (request.readyState == 4 && request.status == 200) {
            result = request.responseText;
            // alert(result);
            imageData = JSON.parse(result);
            if(imageData["totalHits"] == 0) {
              alert("There are no results for this search");
              getImage(false, true);
              return 0;
            }
            if(numImage == imageData["totalHits"]) {
              alert("You have gone through all images with this word. Starting image results over.");
              numImage = 0;
            }
            document.getElementById("picture").innerHTML ="<img class='picture' src='" + imageData["hits"][numImage]["webformatURL"] + "'>";
            var image_name = imageData["hits"][numImage]["webformatURL"];
            document.getElementById("image").innerHTML = image_name;
          }
          else if (request.readyState == 4 && request.status != 200) {
            document.getElementById("picture").innerHTML = "Something is wrong!  Check the logs to see where this went off the rails";
          }
          else if (request.readyState == 3) {
            document.getElementById("picture").innerHTML = "Too soon!  Try again";
          }
        }
      request.send();
      }


      //validates that data was entered...then it calls function(s) to either add
      //a username to the database, or say "choose a different username!"
      // function validate()
      // {
      //     var uLength = document.getElementsByName("username")[0].value.length;
      //     var pLength = document.getElementsByName("password")[0].value.length;
      //     if (uLength == 0 || pLength == 0)
      //       alert("Please fill in all fields!");
      //     else {
      //     //basically, calls 2 functions I believe.
      //     //1) old user error message "please choose a different username!"
      //     //2) newUser...add a new user to the database
      //     queryForm.addEventListener('submit', e => {
      //       e.preventDefault();
      //       oldUser();
      //     })
      //   }
      // }


      //---------------------FORM JAVASCRIPT CODE--------------------//

      // const queryForm = document.querySelector('form')
      // const query = document.querySelector('input')
      //
      // console.log(queryForm); //gets the form
      // console.log(query); //gets username
      //
      //
      // //treats input like an old username...if it isn't, then it calls the newUser function
      // async function oldUser() {
      //   const oldUsername = query.value;
      //   console.log(oldUsername);
      //   const response = await fetch('/q?username=' + oldUsername);
      //   console.log(response);
      //
      //   const result = await response.json();
      //
      //   if (result.username === undefined) {
      //     console.log("That username is taken, please enter a new username");
      //   } else
      //     newUser();
      // }
      //
      // //writing to the database ...something here is wrong I bet.
      // async function newUser() {
      //   const newUsername = query.value;
      //
      //   const usernameJson = { // not sure about this
      //     username: newUsername
      //   }
      //
      //   const fetchOptions = {
      //     method: 'POST',
      //      headers: {
      //        'Accept': 'application/json',
      //        'Content-Type': 'application/json'
      //      },
      //      body: JSON.stringify(usernameJson)
      //    };
      //
      //    await fetch('submit/' + newUsername, fetchOptions);
      //   }

    </script>
  </body>
</html>
